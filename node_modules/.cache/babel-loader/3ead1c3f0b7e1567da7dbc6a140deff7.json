{"ast":null,"code":"import _toConsumableArray from\"/home/revpro/Desktop/new/ToDoApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/revpro/Desktop/new/ToDoApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from\"react\";import netCalls from\"../netCallsMod\";import ListSelector from\"./ListSelector\";import SearchBar from\"./SearchBar\";import TodoList from\"./TodoList\";import InputTodo from\"./InputTodo\";import ShareableLink from\"./ShareableLink\";import{TreeMirrorClient}from\"../tree_mirror\";import\"./TodoApp.css\";var PORT=8000;var ScreenSharePORT=7000;var getURL=\"http://localhost:\".concat(PORT,\"/getdata\");var socketURL=\"ws://localhost:\".concat(ScreenSharePORT,\"/screenShareClient\");function useScreenShareWithWebRTC(){var _useState=useState(\"off\"),_useState2=_slicedToArray(_useState,2),sharing=_useState2[0],setSharing=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),setSocket=_useState4[1];var peer=useRef(null);var dataChannel=useRef(null);var msgs=useRef([JSON.stringify({clear:true})]);var peerConn=useRef(false);useEffect(function(){var peerDataSend=function peerDataSend(data){if(peerConn.current===false){msgs.current.push(JSON.stringify(data));}else{dataChannel.current.send(JSON.stringify(data));}};console.log(sharing);if(sharing===\"off\"){console.log(\"Entering off\");// if(shareSocket !== undefined) shareSocket.close();\n// setSocket(undefined);\nsetSocket(function(socket){if(socket!==undefined)socket.close();return undefined;});}else{var socket=new WebSocket(socketURL+\"?hash=\".concat(sharing));setSocket(socket);var mirrorClient;var mousePos;document.onmousemove=function(e){var width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;mousePos={x:e.pageX,y:e.pageY,width:width,height:height};// socket.send(JSON.stringify(mousePos));\npeerDataSend(mousePos);};window.onscroll=function(){var verScroll=document.documentElement.scrollTop||document.body.scrollTop;// socket.send(JSON.stringify({ scroll: verScroll }));\npeerDataSend({scroll:verScroll});};socket.onopen=function(){peerDataSend({base:window.location.href.match(/^(.*\\/)[^/]*$/)[1]});mirrorClient=new TreeMirrorClient(document,{initialize:function initialize(rootId,children){peerDataSend({f:\"initialize\",args:[rootId,children]});},applyChanged:function applyChanged(removed,addedOrMoved,attributes,text){peerDataSend({f:\"applyChanged\",args:[removed,addedOrMoved,attributes,text]});}},null);};socket.onmessage=function(event){var data=JSON.parse(event.data);console.log(data);if(data.type===\"offer\"){console.log(\"Peer Creation\");var config={iceServers:[{urls:\"stun:stun.l.google.com:19302\"}]};peer.current=new RTCPeerConnection(config);peer.current.onicecandidate=function(event){if(!event||!event.candidate){console.log(event.candidate);return;}socket.send(JSON.stringify({type:\"candidate\",value:event.candidate}));};peer.current.onconnectionstatechange=function(event){if(peer.current.connectionState===\"connected\"){console.log(\"Peer Connected\");}};peer.current.setRemoteDescription(new RTCSessionDescription(data.value));var sdpConstraints={offerToReceiveAudio:false,offerToReceiveVideo:false};peer.current.createAnswer(sdpConstraints).then(function(descrip){console.log(\"Sending Answer\");peer.current.setLocalDescription(descrip);socket.send(JSON.stringify({type:\"answer\",value:descrip}));},null);peer.current.ondatachannel=function(event){dataChannel.current=event.channel;dataChannel.current.onmessage=function(event){console.log(\"Message from Agent to Client on Data Channel\");};dataChannel.current.onopen=function(){console.log(\"Data Channel Opened on Client\");peerConn.current=true;dataChannel.current.send(JSON.stringify(msgs.current));};dataChannel.current.onclose=function(){console.log(\"Data Channel Closed on Client\");};};}if(data.type===\"candidate\"){console.log(\"Processing ICE\");peer.current.addIceCandidate(new RTCIceCandidate(data.value));}};socket.onclose=function(){console.log(\"Screen Sharing Socket Close\");// Maybe send a message to the other peer to close\n// peer.current.destroy();\ndataChannel.current.send(JSON.stringify({clear:true}));peer.current.close();peer.current=null;mirrorClient.disconnect();};}},[sharing]);return[sharing,setSharing];}function TodoApp(props){var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),todos=_useState6[0],setTodos=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),listNum=_useState8[0],setListNum=_useState8[1];var _useState9=useState(1),_useState10=_slicedToArray(_useState9,2),totalLists=_useState10[0],setTotalLists=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),searchQuery=_useState12[0],setSearchQuery=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),filteredTodos=_useState14[0],setFilteredTodos=_useState14[1];var _useState15=useState(new Date().toLocaleDateString(\"en-IN\",{day:\"numeric\",month:\"short\",weekday:\"short\"})),_useState16=_slicedToArray(_useState15,2),date=_useState16[0],setDate=_useState16[1];var _useState17=useState(localStorage.getItem(\"id_token\")),_useState18=_slicedToArray(_useState17,2),id_token=_useState18[0],setID=_useState18[1];var _useScreenShareWithWe=useScreenShareWithWebRTC(),_useScreenShareWithWe2=_slicedToArray(_useScreenShareWithWe,2),sharing=_useScreenShareWithWe2[0],setSharing=_useScreenShareWithWe2[1];var state={todos:todos,listNum:listNum,totalLists:totalLists,searchQuery:searchQuery,filteredTodos:filteredTodos,date:date,id_token:id_token,sharing:sharing};var updateState=function updateState(stateData){if(stateData.todos)setTodos(_toConsumableArray(stateData.todos));if(stateData.listNum)setListNum(stateData.listNum);if(stateData.totalLists)setTotalLists(stateData.totalLists);if(stateData.searchQuery)setSearchQuery(stateData.searchQuery);if(stateData.filteredTodos!==undefined){if(stateData.filteredTodos===null)setFilteredTodos(null);else setFilteredTodos(_toConsumableArray(stateData.filteredTodos));}if(stateData.date)setDate(stateData.date);if(stateData.id_token)setID(stateData.id_token);if(stateData.sharing)setSharing(stateData.sharing);};useEffect(function(){netCalls.getJSON(getURL,1,function(err,data){if(err!==null){console.log(\"Empty\");}else{setTodos(JSON.parse(data[\"json\"]));setTotalLists(Number(data[\"listNum\"]));}},id_token);console.log(\"Reached.\");gapi.load(\"auth2\",function(){gapi.auth2.init();});},[id_token]);var signOutFunc=function signOutFunc(e){e.preventDefault();console.log(\"Sign out started\");var auth2=gapi.auth2.getAuthInstance();auth2.signOut().then(function(){console.log(\"User signed out.\");props.history.push(\"/login\");});};return/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"header\"},/*#__PURE__*/React.createElement(\"div\",{className:\"date\"},date),/*#__PURE__*/React.createElement(\"a\",{href:\"\",id:\"signOut\",onClick:signOutFunc},\"Sign Out\"),/*#__PURE__*/React.createElement(ListSelector,{state:state,updateState:updateState,setTodos:setTodos}),/*#__PURE__*/React.createElement(SearchBar,{state:state,setFilteredTodos:setFilteredTodos,setSearchQuery:setSearchQuery})),/*#__PURE__*/React.createElement(TodoList,{state:state,setTodos:setTodos}),/*#__PURE__*/React.createElement(InputTodo,{state:state,setTodos:setTodos}),/*#__PURE__*/React.createElement(ShareableLink,{state:state}));}export default TodoApp;","map":{"version":3,"sources":["/home/revpro/Desktop/new/ToDoApp/src/components/TodoApp.tsx"],"names":["React","useState","useEffect","useRef","netCalls","ListSelector","SearchBar","TodoList","InputTodo","ShareableLink","TreeMirrorClient","PORT","ScreenSharePORT","getURL","socketURL","useScreenShareWithWebRTC","sharing","setSharing","undefined","setSocket","peer","dataChannel","msgs","JSON","stringify","clear","peerConn","peerDataSend","data","current","push","send","console","log","socket","close","WebSocket","mirrorClient","mousePos","document","onmousemove","e","width","window","innerWidth","documentElement","clientWidth","body","height","innerHeight","clientHeight","x","pageX","y","pageY","onscroll","verScroll","scrollTop","scroll","onopen","base","location","href","match","initialize","rootId","children","f","args","applyChanged","removed","addedOrMoved","attributes","text","onmessage","event","parse","type","config","iceServers","urls","RTCPeerConnection","onicecandidate","candidate","value","onconnectionstatechange","connectionState","setRemoteDescription","RTCSessionDescription","sdpConstraints","offerToReceiveAudio","offerToReceiveVideo","createAnswer","then","descrip","setLocalDescription","ondatachannel","channel","onclose","addIceCandidate","RTCIceCandidate","disconnect","TodoApp","props","todos","setTodos","listNum","setListNum","totalLists","setTotalLists","searchQuery","setSearchQuery","filteredTodos","setFilteredTodos","Date","toLocaleDateString","day","month","weekday","date","setDate","localStorage","getItem","id_token","setID","state","updateState","stateData","getJSON","err","Number","gapi","load","auth2","init","signOutFunc","preventDefault","getAuthInstance","signOut","history"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport netCalls from \"../netCallsMod\";\nimport ListSelector from \"./ListSelector\";\nimport SearchBar from \"./SearchBar\";\nimport TodoList from \"./TodoList\";\nimport InputTodo from \"./InputTodo\";\nimport ShareableLink from \"./ShareableLink\";\nimport ScreenSharing from \"./ScreenSharing\";\nimport { TreeMirrorClient } from \"../tree_mirror\";\nimport \"./TodoApp.css\";\nimport { RouteComponentProps } from \"react-router-dom\";\n\ndeclare var gapi: any;\nconst PORT = 8000;\nconst ScreenSharePORT = 7000;\nconst getURL = `http://localhost:${PORT}/getdata`;\nconst socketURL = `ws://localhost:${ScreenSharePORT}/screenShareClient`;\n\nexport interface TodoItem {\n  text: string;\n  done: boolean;\n  id: number;\n}\n\nexport interface State {\n  todos: TodoItem[];\n  listNum: number;\n  totalLists: number;\n  searchQuery: string;\n  filteredTodos: TodoItem[] | null;\n  date: string;\n  id_token: string | null;\n  sharing: string;\n}\n\nfunction useScreenShareWithWebRTC(): [\n  string,\n  React.Dispatch<React.SetStateAction<string>>\n] {\n  const [sharing, setSharing] = useState<string>(\"off\");\n  const [, setSocket] = useState<WebSocket | undefined>(undefined);\n  const peer = useRef<RTCPeerConnection>(null);\n  const dataChannel = useRef<RTCDataChannel>(null);\n  const msgs = useRef<string[]>([JSON.stringify({ clear: true })]);\n  const peerConn = useRef(false);\n\n  useEffect(() => {\n    let peerDataSend = (data) => {\n      if (peerConn.current === false) {\n        msgs.current.push(JSON.stringify(data));\n      } else {\n        dataChannel.current.send(JSON.stringify(data));\n      }\n    };\n\n    console.log(sharing);\n    if (sharing === \"off\") {\n      console.log(\"Entering off\");\n      // if(shareSocket !== undefined) shareSocket.close();\n      // setSocket(undefined);\n      setSocket((socket) => {\n        if (socket !== undefined) socket.close();\n        return undefined;\n      });\n    } else {\n      let socket = new WebSocket(socketURL + `?hash=${sharing}`);\n      setSocket(socket);\n\n      let mirrorClient: any;\n      let mousePos: { x: number; y: number; width: number; height: number };\n\n      document.onmousemove = (e) => {\n        let width =\n          window.innerWidth ||\n          document.documentElement.clientWidth ||\n          document.body.clientWidth;\n        let height =\n          window.innerHeight ||\n          document.documentElement.clientHeight ||\n          document.body.clientHeight;\n\n        mousePos = {\n          x: e.pageX,\n          y: e.pageY,\n          width: width,\n          height: height,\n        };\n        // socket.send(JSON.stringify(mousePos));\n        peerDataSend(mousePos);\n      };\n\n      window.onscroll = () => {\n        let verScroll =\n          document.documentElement.scrollTop || document.body.scrollTop;\n        // socket.send(JSON.stringify({ scroll: verScroll }));\n        peerDataSend({ scroll: verScroll });\n      };\n\n      socket.onopen = () => {\n        peerDataSend({\n          base: window.location.href.match(/^(.*\\/)[^/]*$/)![1],\n        });\n        mirrorClient = new TreeMirrorClient(\n          document,\n          {\n            initialize: function (rootId: number, children: object[]) {\n              peerDataSend({\n                f: \"initialize\",\n                args: [rootId, children],\n              });\n            },\n\n            applyChanged: function (\n              removed: object[],\n              addedOrMoved: object[],\n              attributes: object[],\n              text: object[]\n            ) {\n              peerDataSend({\n                f: \"applyChanged\",\n                args: [removed, addedOrMoved, attributes, text],\n              });\n            },\n          },\n          null\n        );\n      };\n\n      socket.onmessage = function (event) {\n        let data = JSON.parse(event.data);\n        console.log(data);\n        if (data.type === \"offer\") {\n          console.log(\"Peer Creation\");\n          let config = {\n            iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\n          };\n          peer.current = new RTCPeerConnection(config);\n\n          peer.current.onicecandidate = (event) => {\n            if (!event || !event.candidate) {\n              console.log(event.candidate);\n              return;\n            }\n            socket.send(\n              JSON.stringify({\n                type: \"candidate\",\n                value: event.candidate,\n              })\n            );\n          };\n\n          peer.current.onconnectionstatechange = (event) => {\n            if (peer.current.connectionState === \"connected\") {\n              console.log(\"Peer Connected\");\n            }\n          };\n\n          peer.current.setRemoteDescription(\n            new RTCSessionDescription(data.value)\n          );\n\n          let sdpConstraints = {\n            offerToReceiveAudio: false,\n            offerToReceiveVideo: false,\n          };\n          peer.current.createAnswer(sdpConstraints).then((descrip) => {\n            console.log(\"Sending Answer\");\n            peer.current.setLocalDescription(descrip);\n            socket.send(\n              JSON.stringify({\n                type: \"answer\",\n                value: descrip,\n              })\n            );\n          }, null);\n\n          peer.current.ondatachannel = (event) => {\n            dataChannel.current = event.channel;\n\n            dataChannel.current.onmessage = (event) => {\n              console.log(\"Message from Agent to Client on Data Channel\");\n            };\n            dataChannel.current.onopen = () => {\n              console.log(\"Data Channel Opened on Client\");\n              peerConn.current = true;\n              dataChannel.current.send(JSON.stringify(msgs.current));\n            };\n            dataChannel.current.onclose = () => {\n              console.log(\"Data Channel Closed on Client\");\n            };\n          };\n        }\n        if (data.type === \"candidate\") {\n          console.log(\"Processing ICE\");\n          peer.current.addIceCandidate(new RTCIceCandidate(data.value));\n        }\n      };\n\n      socket.onclose = function () {\n        console.log(\"Screen Sharing Socket Close\");\n        // Maybe send a message to the other peer to close\n        // peer.current.destroy();\n        dataChannel.current.send(JSON.stringify({ clear: true }));\n        peer.current.close();\n        peer.current = null;\n        mirrorClient.disconnect();\n      };\n    }\n  }, [sharing]);\n\n  return [sharing, setSharing];\n}\n\nfunction TodoApp(props: RouteComponentProps) {\n  const [todos, setTodos] = useState<TodoItem[]>([]);\n  const [listNum, setListNum] = useState<number>(1);\n  const [totalLists, setTotalLists] = useState<number>(1);\n  const [searchQuery, setSearchQuery] = useState<string>(\"\");\n  let [filteredTodos, setFilteredTodos] = useState<TodoItem[] | null>(null);\n  const [date, setDate] = useState<string>(\n    new Date().toLocaleDateString(\"en-IN\", {\n      day: \"numeric\",\n      month: \"short\",\n      weekday: \"short\",\n    })\n  );\n  const [id_token, setID] = useState<string | null>(\n    localStorage.getItem(\"id_token\")\n  );\n  const [sharing, setSharing] = useScreenShareWithWebRTC();\n  const state: State = {\n    todos: todos,\n    listNum: listNum,\n    totalLists: totalLists,\n    searchQuery: searchQuery,\n    filteredTodos: filteredTodos,\n    date: date,\n    id_token: id_token,\n    sharing: sharing,\n  };\n\n  let updateState = (stateData: Partial<State>) => {\n    if (stateData.todos) setTodos([...stateData.todos]);\n    if (stateData.listNum) setListNum(stateData.listNum);\n    if (stateData.totalLists) setTotalLists(stateData.totalLists);\n    if (stateData.searchQuery) setSearchQuery(stateData.searchQuery);\n    if (stateData.filteredTodos !== undefined) {\n      if (stateData.filteredTodos === null) setFilteredTodos(null);\n      else setFilteredTodos([...stateData.filteredTodos]);\n    }\n    if (stateData.date) setDate(stateData.date);\n    if (stateData.id_token) setID(stateData.id_token);\n    if (stateData.sharing) setSharing(stateData.sharing);\n  };\n\n  useEffect(() => {\n    netCalls.getJSON(\n      getURL,\n      1,\n      (err: number | null, data: object) => {\n        if (err !== null) {\n          console.log(\"Empty\");\n        } else {\n          setTodos(JSON.parse(data[\"json\"]));\n          setTotalLists(Number(data[\"listNum\"]));\n        }\n      },\n      id_token\n    );\n\n    console.log(\"Reached.\");\n    gapi.load(\"auth2\", function () {\n      gapi.auth2.init();\n    });\n  }, [id_token]);\n\n  let signOutFunc = (e: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n    e.preventDefault();\n    console.log(\"Sign out started\");\n    var auth2 = gapi.auth2.getAuthInstance();\n    auth2.signOut().then(function () {\n      console.log(\"User signed out.\");\n      props.history.push(\"/login\");\n    });\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"header\">\n        <div className=\"date\">{date}</div>\n        <a href=\"\" id=\"signOut\" onClick={signOutFunc}>\n          Sign Out\n        </a>\n        <ListSelector\n          state={state}\n          updateState={updateState}\n          setTodos={setTodos}\n        />\n        <SearchBar\n          state={state}\n          setFilteredTodos={setFilteredTodos}\n          setSearchQuery={setSearchQuery}\n        />\n      </div>\n      <TodoList state={state} setTodos={setTodos} />\n      <InputTodo state={state} setTodos={setTodos} />\n      <ShareableLink state={state} />\n      {/* <ScreenSharing sharing={sharing} setSharing={setSharing} /> */}\n    </div>\n  );\n}\n\nexport default TodoApp;\n"]},"metadata":{},"sourceType":"module"}